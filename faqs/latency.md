---
layout: page
title: Latency
permalink: /faqs/latency.html
site_nav_category_order: 100
is_site_nav_category2: true
site_nav_category: faqs
---

## What is latency?

Latency is the time taken for a signal to travel through a system. Common examples related to audio apps are:

- **Output latency** - Time between an audio sample being generated by an app and the sample being played through the headphone jack or built-in speaker
- **Input latency** - Time between an audio signal being received by a device's audio input, such as the microphone and that same audio data being available to an app
- **Round trip latency** - Input latency + App processing + Output latency
- **MIDI-USB latency** - Time between a MIDI signal being sent by a MIDI controller connected via USB and it arriving to an app
- **MIDI-BT latency** - Time between a MIDI signal being sent by a MIDI controller connected via Bluetooth and it arriving to an app
- **Touch latency** - Time between a user touching the screen and that touch event being received by an app

## How can I measure round-trip audio latency?
You can measure round-trip audio latency by creating an app which generates an audio signal, listens for that signal and measures the time between sending it and receiving it.

Alternatively, you can install this [latency testing app](https://play.google.com/store/apps/details?id=org.drrickorang.loopback). This performs a round-trip latency test using the [Larsen test](https://source.android.com/devices/audio/latency_measure.html#larsenTest).

Since the lowest latency is achieved over audio paths with minimal signal processing you may also want to use an [Audio Loopback Dongle](https://source.android.com/devices/audio/latency_measure.html#loopback) which will allow the test to be run over the headset connector. TODO: Where can these be purchased?

## Why does using the headset result in lower latency?
The speakers and microphones used in mobile devices generally have poor acoustics due to their small size. For this reason, signal processing is added to improve the sound quality. This signal processing introduces latency.

If your app relies on low latency audio you should advise users to use the headset. For example, by displaying a "Best with headphones" screen on first run.

Note that just using the headset doesn't guarantee the lowest possible latency. You may need to perform other steps to remove any unwanted signal processing from the audio path, such as by using the [VOICE_RECOGNITION](TODO) preset when recording. TODO: add link to recording tips

## What is the lowest possible round-trip audio latency?
The lowest possible round-trip audio latency varies greatly depending on device model and Android build.

To find it out you can use the following techniques:

- Measure it yourself using a latency testing app and loopback dongle
- *For Nexus devices* use the [published measurements](https://source.android.com/devices/audio/latency_measurements.html)

You can also get a rough idea of audio performance by testing whether the device reports support for the [low_latency](http://developer.android.com/reference/android/content/pm/PackageManager.html#FEATURE_AUDIO_LOW_LATENCY) and [pro](http://developer.android.com/reference/android/content/pm/PackageManager.html#FEATURE_AUDIO_PRO) hardware features.

## What is the lowest possible audio output latency?
It is difficult to test audio output latency in isolation since it requires knowing exactly when the first sample is sent into the audio path ([although this can be done using a light testing circuit and an oscilloscope](https://source.android.com/devices/audio/testing_circuit.html)).

If you know the round-trip audio latency you can use the rough rule of thumb: **Audio output latency is half the round trip audio latency over paths without signal processing**.

## What is the lowest possible audio input latency?
As with output latency, input latency is difficult to measure in isolation. The best solution at this time is to measure round-trip audio and divide by two. (TODO: Really?)

## How can I find the audio latency of a device at runtime?
There is currently no API to determine audio latency over any path on an Android device at runtime. You can, however, use the following hardware feature flags to find out whether the device makes any guarantees for latency.

- [android.hardware.audio.low_latency](http://developer.android.com/reference/android/content/pm/PackageManager.html#FEATURE_AUDIO_LOW_LATENCY) - indicates a continuous *output* latency of 45 milliseconds or less
- [android.hardware.audio.pro](http://developer.android.com/reference/android/content/pm/PackageManager.html#FEATURE_AUDIO_PRO) - indicates a continuous *round-trip* latency of 20 milliseconds or less

The criteria for reporting these flags is defined in the [Android Compatibility Definition Document](http://static.googleusercontent.com/media/source.android.com/en//compatibility/android-cdd.pdf) under section 5.6 Audio Latency and 5.10 Pro Audio.

Here's how to check for these features in Java:

    boolean claimsLowLatencyFeature = getPackageManager().hasSystemFeature(PackageManager.FEATURE_AUDIO_LOW_LATENCY);
    boolean claimsProFeature = getPackageManager().hasSystemFeature(PackageManager.FEATURE_AUDIO_PRO);
